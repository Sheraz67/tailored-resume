<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resume Tailor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>

  <!-- Loading overlay -->
  <div class="loading-overlay" id="loading-overlay">
    <div class="spinner"></div>
    <div class="loading-text">Tailoring your resume with AI...</div>
    <div class="loading-step" id="loading-step">Parsing your resume...</div>
  </div>

  <!-- Error toast -->
  <div class="error-toast" id="error-toast"></div>

  <div class="app-container">
    <!-- Quick-copy LinkedIn -->
    <div class="linkedin-bar" id="linkedin-bar">
      <span class="linkedin-icon">in</span>
      <span class="linkedin-url" id="linkedin-url">https://www.linkedin.com/in/shaun-clark-2a47163b/</span>
      <button type="button" class="linkedin-copy-btn" id="linkedin-copy-btn">Copy</button>
    </div>

    <header>
      <h1>Resume Tailor</h1>
      <p>Upload your resume & prompt once. Just change the JD for each application.</p>
    </header>

    <form id="tailor-form">
      <!-- API Keys -->
      <div class="api-key-row">
        <div class="api-key-group api-key-group-provider">
          <label for="ai-provider">AI Provider</label>
          <select id="ai-provider" class="provider-select">
            <option value="claude">Claude</option>
            <option value="gemini">Gemini</option>
          </select>
        </div>
        <div class="api-key-group" id="claude-key-group">
          <label for="api-key">Anthropic API Key</label>
          <input type="password" id="api-key" placeholder="sk-ant-api03-..." autocomplete="off" />
        </div>
        <div class="api-key-group" id="gemini-key-group" style="display: none;">
          <label for="gemini-key">Gemini API Key</label>
          <input type="password" id="gemini-key" placeholder="AIza..." autocomplete="off" />
        </div>
        <div class="api-key-group">
          <label for="apify-key">Apify API Token <span class="label-hint">(for URL scraping)</span></label>
          <input type="password" id="apify-key" placeholder="apify_api_..." autocomplete="off" />
        </div>
      </div>

      <!-- ═══════════════════════════════════════════
           FIXED SECTION: Resume + Prompt (set once)
           ═══════════════════════════════════════════ -->
      <div class="setup-section" id="setup-section">
        <div class="setup-header" id="setup-header">
          <div class="setup-header-left">
            <h2>Your Profile</h2>
            <span class="setup-subtitle" id="setup-subtitle">Set up your resume and tailoring prompt once</span>
          </div>
          <div class="setup-header-right">
            <span class="setup-status" id="setup-status"></span>
            <button type="button" class="setup-toggle-btn" id="setup-toggle-btn">
              <span class="chevron" id="setup-chevron">&#9660;</span>
            </button>
          </div>
        </div>

        <div class="setup-body" id="setup-body">
          <div class="input-grid">
            <!-- Resume upload -->
            <div class="input-card">
              <h3><span class="icon">1</span> Your Resume</h3>
              <div class="file-upload-zone" id="upload-zone">
                <input type="file" id="resume-file" accept=".docx,.pdf,.txt" />
                <div class="upload-icon">+</div>
                <div class="upload-text">
                  <strong>Click to upload</strong> or drag and drop<br />
                  .docx, .pdf, or .txt
                </div>
                <div class="file-name" id="file-name" style="display: none;"></div>
              </div>
            </div>

            <!-- Tailoring prompt -->
            <div class="input-card">
              <h3><span class="icon">2</span> Tailoring Prompt <span class="label-hint">(optional — built-in default used if empty)</span></h3>
              <div class="input-toggle">
                <button type="button" class="toggle-btn active" data-target="prompt-upload-mode">Upload File</button>
                <button type="button" class="toggle-btn" data-target="prompt-paste-mode">Paste Text</button>
              </div>
              <div id="prompt-upload-mode" class="input-mode active">
                <div class="file-upload-zone" id="prompt-upload-zone">
                  <input type="file" id="prompt-file" accept=".txt,.docx,.pdf" />
                  <div class="upload-icon">+</div>
                  <div class="upload-text">
                    <strong>Click to upload</strong> or drag and drop<br />
                    .txt, .docx, or .pdf<br />
                    <span class="label-hint">Optional — we use our built-in prompt if you don't upload one</span>
                  </div>
                  <div class="file-name" id="prompt-file-name" style="display: none;"></div>
                </div>
              </div>
              <div id="prompt-paste-mode" class="input-mode">
                <textarea id="prompt-text" rows="8" placeholder="Optional — paste a custom tailoring prompt here, or leave empty to use our built-in default."></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ═══════════════════════════════════════════
           MAIN INPUT: Job Description (changes each time)
           ═══════════════════════════════════════════ -->
      <div class="jd-section">
        <div class="input-card jd-card">
          <h3><span class="icon">3</span> Job Description <span class="jd-badge">Changes each application</span></h3>
          <div class="jd-url-row">
            <input type="url" id="jd-url" class="jd-url-input" placeholder="https://www.linkedin.com/jobs/view/..." />
            <button type="button" class="btn btn-scrape" id="scrape-btn">Scrape JD</button>
          </div>
          <div class="scrape-status" id="scrape-status"></div>
          <textarea id="jd-text" rows="10" placeholder="Paste the full job description here — or enter a URL above and click Scrape JD.&#10;&#10;This is the only thing you need to change for each new application."></textarea>
        </div>
      </div>

      <!-- Submit -->
      <div class="action-row">
        <button type="submit" class="btn btn-primary">Tailor My Resume</button>
      </div>
    </form>

    <!-- Results -->
    <div class="results-section" id="results-section">
      <div class="results-header">
        <h2>Tailored Resume</h2>
        <button class="btn btn-success" id="download-btn">Download PDF</button>
      </div>

      <div class="results-tabs">
        <button class="tab-btn active" data-tab="tab-preview">Resume Preview</button>
        <button class="tab-btn" data-tab="tab-qa">Application Q&A</button>
      </div>

      <!-- Tab: Resume Preview -->
      <div class="tab-content active" id="tab-preview">
        <div class="resume-preview" id="resume-preview"></div>
      </div>

      <!-- Tab: Application Q&A -->
      <div class="tab-content" id="tab-qa">
        <div class="qa-section">
          <div class="qa-intro">
            <h3>Application Questions</h3>
            <p>Paste the questions from the job application below (one per line). Answers will be generated using your resume and the job description as context.</p>
          </div>
          <textarea id="qa-questions" rows="6" placeholder="Why are you interested in this role?
What experience do you have with React?
Describe a challenging project you worked on..."></textarea>
          <div class="qa-action-row">
            <button type="button" class="btn btn-primary" id="qa-submit-btn">Generate Answers</button>
          </div>
          <div class="qa-loading" id="qa-loading" style="display: none;">
            <div class="spinner" style="width: 32px; height: 32px;"></div>
            <span>Crafting your answers...</span>
          </div>
          <div id="qa-results"></div>
        </div>
      </div>
    </div>
    <!-- ═══════════════════════════════════════════
         JOB APPLICATION TRACKER
         ═══════════════════════════════════════════ -->
    <div class="tracker-section" id="tracker-section">
      <div class="tracker-header">
        <h2>Job Application Tracker</h2>
        <div class="tracker-actions">
          <button type="button" class="btn btn-tracker" id="tracker-copy-btn">Copy to Clipboard (Excel)</button>
          <button type="button" class="btn btn-tracker btn-tracker-danger" id="tracker-clear-btn">Clear All</button>
        </div>
      </div>
      <div class="tracker-table-wrap">
        <table class="tracker-table" id="tracker-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Job Link</th>
              <th>Platform</th>
              <th>Company</th>
              <th>Role</th>
              <th>Status</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tracker-tbody"></tbody>
        </table>
        <div class="tracker-empty" id="tracker-empty">No applications tracked yet. Tailor a resume to add an entry automatically.</div>
      </div>
    </div>
  </div>

  <script src="/static/app.js"></script>
</body>
</html>
